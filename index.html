<!--
 * @Date: 2021-07-05 13:55:13
 * @LastEditors: bujiajia
 * @LastEditTime: 2021-07-05 13:56:16
 * @FilePath: /test/index.html
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="q">1</div>
    <div id="qq">2</div>
    <button id="btn">顶我</button>
  </body>
</html>
<script>
  let obj = {
    value: 1,
    age: 2
  }
  let nwatch = new watch(obj, function (key, value) {
    if (key === 'value') document.getElementById('q').innerHTML = value
  })
  let qwatch = new watch(obj, function (key, value) {
    if (key === 'age') document.getElementById('qq').innerHTML = value
  })
  window.addEventListener('click', function () {
    nwatch.value = nwatch.value + 1
    qwatch.age = qwatch.age + 2
  })

  // watch(obj, "value", function (nv) {
  //   document.getElementById("q").innerHTML = nv;
  // });
  // watch(obj, "age", function (nv) {
  //   document.getElementById("qq").innerHTML = nv;
  // });

  function watch(obj, fnc) {
    let value = obj[name]

    // Object.defineProperty(obj, name, {
    //   get() {
    //     return value;
    //   },
    //   set(nv) {
    //     console.log("set", nv);
    //     value = nv;
    //     fnc(value);
    //   },
    // });
    return new Proxy(obj, {
      get(obj, prop) {
        return obj[prop]
      },
      set(obj, prop, value) {
        obj[prop] = value
        fnc(prop, value)
      }
    })
  }
</script>
